# 미국 시나리오 확률 개선방안

**분석일**: 2025-12-15
**분석 대상**: us_stock_grade 테이블 전체 데이터
**분석 도구**: analyze_us_scenario_calibration.py

---

## 1. 현황 분석 요약

### 1.1 전체 예측 오차 현황

| 구분 | 평균 예측값 | 실제 발생률 | 오차 | 상태 |
|------|------------|------------|------|------|
| Bullish | 34.4% | 35.7% | **-1.3%p** | 양호 |
| Sideways | 31.3% | 27.4% | +3.9%p | 약간 과대 |
| Bearish | 34.3% | 36.9% | **-2.6%p** | 약간 과소 |

**핵심 발견**: 미국 모델은 한국 모델 대비 **매우 양호한 예측 정확도**를 보임
- 총 절대 오차: **7.8%p** (한국 모델 36.7%p 대비 78% 감소)
- Calibration 로직 없이 Raw Backtest 데이터 사용으로 안정적 예측

### 1.2 한국 vs 미국 모델 비교

| 항목 | 한국 모델 | 미국 모델 |
|------|---------|---------|
| Bullish 기준 | +10% 이상 | **+5% 이상** |
| Bearish 기준 | -10% 이하 | **-5% 이하** |
| Calibration 로직 | 있음 (3.01x 승수) | **없음** (Raw 사용) |
| 분류 기준 | Theme (17개) | Sector (11개) |
| 총 예측 오차 | **36.7%p** | **7.8%p** |
| 주요 문제 | Bearish 과대예측 | 경미한 Bearish 과소예측 |

### 1.3 Sector별 예측 오차

| Sector | 샘플수 | Bullish 오차 | Bearish 오차 | 총 오차 | 상태 |
|--------|--------|-------------|-------------|---------|------|
| REAL ESTATE | 6,832 | +0.6%p | +0.1%p | **1.4%p** | 매우 양호 |
| UTILITIES | 2,841 | -0.9%p | -0.7%p | **3.1%p** | 매우 양호 |
| FINANCIAL SERVICES | 23,111 | +2.6%p | -1.0%p | **5.2%p** | 양호 |
| CONSUMER DEFENSIVE | 6,106 | -0.8%p | -2.0%p | **5.6%p** | 양호 |
| CONSUMER CYCLICAL | 15,584 | -2.1%p | -2.4%p | **9.0%p** | 양호 |
| ENERGY | 5,523 | -3.6%p | -1.0%p | **9.3%p** | 양호 |
| BASIC MATERIALS | 5,879 | -3.4%p | -1.3%p | **9.4%p** | 양호 |
| INDUSTRIALS | 18,144 | -3.3%p | -1.6%p | **9.8%p** | 양호 |
| COMMUNICATION SERVICES | 6,629 | -2.6%p | -2.5%p | **10.2%p** | 보통 |
| TECHNOLOGY | 20,266 | -1.4%p | **-3.9%p** | **10.5%p** | 보통 |
| HEALTHCARE | 29,600 | -1.9%p | **-5.2%p** | **14.1%p** | 주의 필요 |

**주요 발견**:
- **REAL ESTATE, UTILITIES**: 가장 정확한 예측 (오차 < 4%p)
- **HEALTHCARE**: Bearish 과소예측 -5.2%p (개선 필요)
- **TECHNOLOGY**: Bearish 과소예측 -3.9%p (개선 고려)
- 대부분의 Sector: 양호한 범위 내 (< 10%p)

### 1.4 Sample Count별 예측 정확도

| Sample 범위 | 예측건수 | Bullish 오차 | Bearish 오차 | 총 오차 |
|-------------|----------|-------------|-------------|---------|
| 0-19 | 47 | 1.9%p | 11.0%p | 22.1%p |
| 20-49 | 68 | 1.4%p | 0.1%p | **3.0%p** |
| 50-99 | 312 | 8.5%p | 2.6%p | 16.9%p |
| 100-199 | 1,126 | 2.2%p | 0.6%p | **4.3%p** |
| **200+** | **139,156** | **1.3%p** | **2.6%p** | **7.8%p** |

**발견**:
- 대부분의 예측(99.9%)이 200+ 샘플 기반으로 높은 신뢰도 확보
- 한국 모델과 달리 Sample Count가 낮아도 상대적으로 안정적

---

## 2. 에러 케이스 분석

### 2.1 에러 케이스 특성

**총 에러 케이스**: 다수 (주로 Penny Stock)

**에러 유형 분포**:
| 에러 유형 | 설명 | 주요 원인 |
|----------|------|----------|
| HIGH_BEAR_POSITIVE_RETURN | Bearish 예측 > 30%인데 실제 수익률 양수 | Penny Stock의 극단적 변동 |
| LOW_BULL_HIGH_RETURN | Bullish 예측 < 20%인데 실제 수익률 > 100% | 예측 불가능한 급등 |

### 2.2 대표 에러 케이스

| 종목 | Sector | Bearish 예측 | 실제 수익률 | 특성 |
|------|--------|-------------|------------|------|
| GNLN (Greenlane Holdings) | CONSUMER DEFENSIVE | 54% | **+40,800%** | Penny Stock |
| SBDS | CONSUMER CYCLICAL | 57% | **+24,337%** | Penny Stock |
| STSS (Sharps Technology) | HEALTHCARE | 54% | **+17,833%** | Penny Stock |
| DVLT (Datavault AI) | TECHNOLOGY | 40% | **+14,033%** | Penny Stock |
| MAXN (Maxeon Solar) | TECHNOLOGY | 57% | **+13,420%** | Penny Stock |

### 2.3 에러 케이스 분석 결과

1. **공통 특성**: 대부분 Penny Stock (주가 < $5) 또는 시가총액 극소형
2. **변동성**: 극단적 수익률 (1000% ~ 40,000%)
3. **예측 불가능**: 합병, 역분할, 스퀴즈 등 예측 불가능한 이벤트
4. **모델 한계**: 이러한 극단적 케이스는 어떤 모델로도 예측 어려움

**결론**: 에러 케이스는 모델 문제가 아닌 **시장 특성** (Penny Stock 극단적 변동)

---

## 3. Sector별 Calibration 권장안

### 3.1 권장 Calibration 승수

| Sector | Bullish 권장 | Bearish 권장 | Bull 조정 | Bear 조정 |
|--------|-------------|-------------|----------|----------|
| HEALTHCARE | 1.05 | **1.14** | OK | **INCREASE** |
| TECHNOLOGY | 1.04 | **1.11** | OK | **INCREASE** |
| COMMUNICATION SERVICES | 1.08 | 1.06 | OK | OK |
| INDUSTRIALS | 1.09 | 1.05 | OK | OK |
| CONSUMER CYCLICAL | 1.07 | 1.06 | OK | OK |
| BASIC MATERIALS | 1.10 | 1.04 | OK | OK |
| ENERGY | 1.09 | 1.04 | OK | OK |
| CONSUMER DEFENSIVE | 1.03 | 1.05 | OK | OK |
| FINANCIAL SERVICES | 0.92 | 1.04 | OK | OK |
| REAL ESTATE | 0.98 | 1.00 | OK | OK |
| UTILITIES | 1.03 | 1.03 | OK | OK |

### 3.2 Healthcare/Technology Calibration 적용 검토

현재 미국 모델은 Calibration 로직이 없음. 필요시 아래와 같이 적용:

```python
# 선택적 Calibration Map (필요시에만 적용)
US_SECTOR_CALIBRATION = {
    'HEALTHCARE': {
        'bearish_multiplier': 1.14,  # 실제 42.8% vs 예측 37.6%
        'apply_calibration': True
    },
    'TECHNOLOGY': {
        'bearish_multiplier': 1.11,  # 실제 39.9% vs 예측 36.0%
        'apply_calibration': True
    }
    # 나머지 Sector는 Calibration 불필요
}
```

---

## 4. 예상 수익률 범위 분석

### 4.1 Sector별 실제 수익률 분포 (P25~P75 기준)

| Sector | Bullish 범위 | Sideways 범위 | Bearish 범위 |
|--------|-------------|---------------|--------------|
| HEALTHCARE | +12.1~+48.2% | -2.6~+2.2% | -30.7~-11.0% |
| TECHNOLOGY | +10.5~+35.7% | -2.5~+2.3% | -26.3~-9.9% |
| FINANCIAL SERVICES | +7.7~+19.1% | -2.0~+1.9% | -16.8~-7.5% |
| INDUSTRIALS | +9.4~+29.1% | -2.6~+2.4% | -24.1~-8.9% |
| CONSUMER CYCLICAL | +9.6~+28.0% | -2.6~+2.4% | -24.7~-9.3% |
| CONSUMER DEFENSIVE | +8.5~+26.0% | -2.4~+2.4% | -23.3~-8.6% |
| REAL ESTATE | +7.6~+18.5% | -2.5~+2.1% | -18.3~-7.7% |
| COMMUNICATION SERVICES | +9.7~+30.8% | -2.6~+2.0% | -26.8~-9.6% |
| BASIC MATERIALS | +9.9~+30.3% | -2.5~+2.2% | -22.1~-8.6% |
| ENERGY | +8.7~+21.3% | -2.2~+2.7% | -19.9~-8.6% |
| UTILITIES | +7.1~+18.8% | -1.7~+2.8% | -17.5~-7.4% |

### 4.2 Score 구간별 실제 수익률 분포

| Score 구간 | Bullish 비율 | Bullish 범위 | Bearish 비율 | Bearish 범위 |
|-----------|-------------|-------------|-------------|--------------|
| 20 | 35.4% | +15.4~+71.9% | 49.9% | -41.0~-14.4% |
| 30 | 31.1% | +13.3~+75.8% | 49.6% | -38.6~-13.3% |
| 40 | 33.2% | +11.1~+48.2% | 45.1% | -30.1~-10.8% |
| 50 | 34.0% | +9.3~+31.0% | 38.1% | -23.8~-8.9% |
| 60 | 36.9% | +8.6~+22.7% | 30.8% | -18.9~-7.9% |
| 70 | 41.6% | +9.1~+24.1% | 28.6% | -17.9~-7.9% |
| 80 | 48.9% | +11.5~+36.1% | 27.0% | -21.3~-8.6% |
| 90 | 53.6% | +7.8~+32.7% | 28.6% | -20.8~-8.2% |

**발견**: Score가 높을수록 Bullish 비율 증가 (Score 80+에서 48.9% → 53.6%)

---

## 5. 핵심 권장사항

### 5.1 현재 모델 유지 권장

**이유**:
1. 전체 예측 오차 7.8%p로 매우 양호
2. Calibration 로직 없이도 안정적 성능
3. 대부분의 Sector에서 균형 잡힌 예측

### 5.2 선택적 개선 사항

#### 5.2.1 Healthcare/Technology Bearish 보정 (선택)

```python
def apply_sector_calibration(sector: str, raw_bearish: float) -> float:
    """Healthcare, Technology Sector에 대해 Bearish 약간 상향"""
    if sector == 'HEALTHCARE':
        return raw_bearish * 1.14
    elif sector == 'TECHNOLOGY':
        return raw_bearish * 1.11
    return raw_bearish
```

#### 5.2.2 Penny Stock 필터링 (권장)

```python
def filter_extreme_cases(symbol: str, market_cap: float, price: float) -> bool:
    """극단적 변동 가능성이 높은 종목 제외"""
    # 시가총액 < $50M 또는 주가 < $1 인 종목은 별도 처리
    if market_cap < 50_000_000 or price < 1.0:
        return True  # 별도 처리 필요
    return False
```

### 5.3 구현 우선순위

| 우선순위 | 항목 | 효과 | 난이도 |
|---------|------|------|-------|
| 1 (선택) | Healthcare Bearish 1.14x | +0.7%p 개선 | 낮음 |
| 2 (선택) | Technology Bearish 1.11x | +0.4%p 개선 | 낮음 |
| 3 (권장) | Penny Stock 필터링 | 에러 케이스 감소 | 중간 |
| 4 (유지) | 현행 유지 | - | - |

---

## 6. 한국 모델 대비 미국 모델 장점

### 6.1 설계 차이점 분석

| 항목 | 한국 모델 문제점 | 미국 모델 장점 |
|------|----------------|---------------|
| Calibration | 3.01x 과도한 승수 | Calibration 없음 |
| 임계값 | ±10% (넓음) | ±5% (적절) |
| 예측 편향 | Bearish 과대예측 | 경미한 과소예측 |
| 오차 수준 | 36.7%p (심각) | 7.8%p (양호) |

### 6.2 미국 모델이 더 나은 이유

1. **Calibration 미적용**: Raw Backtest 데이터가 이미 충분히 정확
2. **±5% 임계값**: 시장 특성에 맞는 적절한 구분 기준
3. **Sector 기반 분류**: Theme보다 안정적인 분류 체계
4. **충분한 샘플 수**: 대부분 200+ 샘플로 높은 신뢰도

---

## 7. 결론

### 7.1 요약

- **미국 모델 현황**: 총 오차 7.8%p로 **매우 양호**
- **주요 이슈**: Healthcare/Technology의 경미한 Bearish 과소예측
- **에러 케이스**: Penny Stock 특성으로 모델 한계가 아닌 시장 특성
- **권장사항**: **현행 유지** 또는 선택적 미세 조정

### 7.2 한국 모델 개선에 대한 시사점

미국 모델의 성공 요인을 한국 모델에 적용 검토:
1. Calibration 승수 대폭 감소 또는 제거
2. 임계값 ±10% → ±7% 축소 검토
3. Theme별 세분화된 Calibration Map 적용

---

## 8. 참고: 분석 데이터 파일

| 파일명 | 설명 |
|--------|------|
| 1_sector_actual_distribution.csv | Sector별 실제 수익률 분포 |
| 2_sector_prediction_error.csv | Sector별 예측 오차 |
| 3_error_cases.csv | 에러 케이스 상세 목록 |
| 4_sample_count_accuracy.csv | Sample Count별 예측 정확도 |
| 5_recommended_calibration_map.csv | Sector별 권장 Calibration 승수 |
| 6_return_range_accuracy.csv | Sector별 수익률 범위 |
| 7_return_percentiles_by_sector.csv | Sector별 수익률 백분위 |
| 8_return_percentiles_by_score.csv | Score별 수익률 백분위 |

---

**작성자**: Claude Code
**분석 스크립트**: `us/analysis/analyze_us_scenario_calibration.py`
